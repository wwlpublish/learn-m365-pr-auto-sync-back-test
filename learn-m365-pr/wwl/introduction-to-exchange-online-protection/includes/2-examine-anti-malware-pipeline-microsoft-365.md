Organizations that have hosted mailboxes in Exchange Online rely on Exchange Online Protection (EOP) to protect incoming and outgoing mail. When an organization joins Microsoft 365, an administrator must add Microsoft 365 specific MX and TXT records to their domain name in DNS.

 -  The MX record ensures that email sent to the tenant’s domain will arrive in mailboxes hosted in Exchange Online through the EOP service.
 -  The Sender Protection Framework (SPF) record is a special type of TXT record in DNS. It identifies a host as a valid sender for the organization's domain.

Before mail enters the Microsoft 365 network and is processed by EOP, techniques such as IP and sender reputation, combined with heuristics, catch a sizeable amount of spam and bulk email at the first entry point in Microsoft 365. Once mail passes through the first entry point in Microsoft 365, it's scanned by multiple signature-based anti-virus scanners. This process alone is effective in catching up to 80% of commodity malware coming into the network. But malicious attachments that are heavily modified or released with many different variants coming out at the same time can still get through.

Once mail enters the Microsoft 365 network, EOP scans individual files using a technique called reputation block. With reputation block, EOP compares file attachments with the results of scans that were previously completed throughout Microsoft 365. It then checks to see if there are specific files – or pieces of files – that were previously identified as malicious that appear to match something in an incoming message.

Heuristic clustering is used to identify mail as suspicious based on an analysis of delivery patterns. When this process occurs, a sample from a cluster is sent to a hypervisor sandbox environment where the file is opened for further analysis. This analysis includes:

 -  Checking for anomalies such as changes in memory, the registry, or encryption of the hard drive.
 -  Checking for changes in network traffic, such as connections to hacker’s command and control servers.
 -  Identifying when malware tries to obfuscate itself or use evasion techniques.

Once these signals are collected, the results are run through a machine-learning (ML) model and a set of static rules to determine if the file is suspicious or, in fact, truly malicious.

If Microsoft Defender for Office 365 (formerly Microsoft 365 Advanced Threat Protection (ATP)) is enabled in the tenant, it extends the protection of EOP by scanning mail that made it through the filters and techniques described above. Microsoft Defender for Cloud's Safe Attachments feature scans all file attachments - whether they appear to be suspicious or not - to protect against malware that doesn’t have a known AV signature. Attachments are opened in the same sandboxing environment used by EOP and analyzed for behavioral changes – again, changes to the registry, memory, and so on.

After the Safe Attachments process has completed, the actual body of the message - including the message headers - is run through EOP’s anti-spam, phish, and spoof filters. If there are any URLs embedded in the message body, and Microsoft Defender for Office 365 is enabled in the tenant, then its Safe Links feature checks the link against a list of known malicious URLs that is updated approximately every 20 minutes.

Finally, Microsoft is also engaged with a team of security analysts, or cyber hunters, who can identify new threat campaigns and quickly implement rules to further protect the Microsoft 365 network against cyber-attacks.

The anti-malware pipeline that is composed of EOP and Microsoft Defender for Office 365 provides protection against all types of spam and advanced threats. This protection is provided through a multi-layered, defense-in-depth approach to solving email security.

:::image type="content" source="../media/antimalware-pipeline-with-eop-and-atp-97524481.png" alt-text="graphic of anti-malware pipeline with EOP and ATP":::


## Knowledge check

Choose the best response for the following question. Then select “Check your answers.”
